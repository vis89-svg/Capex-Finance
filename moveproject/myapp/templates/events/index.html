


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .card {
            cursor: pointer;
            border: 1px solid black;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.3s ease;
        }
        .hidden-scrollbar {
            
        overflow: scroll; /* Enable scrolling */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */


        }
        .card.selected {
        border: 2px solid #007bff; /* Blue border for selected card */
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.5); /* Optional: add a blue glow effect */
    }


        .hidden-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari */

            }


        .form-switch {
            position: relative; /* Changed to fixed for viewport positioning */
            top: 0px;
            left: 1230px;
            z-index: 1000; /* Ensure the switch is on top */
            transform: scale(1.8); /* Scale the switch to increase its size */
            transform-origin: top right;
        }

        /* Remove or comment out this hover effect */
        /*.card:hover {
            border: 0.6px solid red;
        }*/

        .card-body {
            display: flex;
            flex-direction: column;
            font-family: "Montserrat", sans-serif;
            
            border: #1A1919;
            height: 100px;
            padding: 15px;
            color: white;
        }

        .card-title {
            font-size: 1.25rem;
            margin-bottom: 10px;
        }

        .card-text {
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .total-amount {
            font-weight: 200;
            font-size: 16px;
            color: yellow;
            font-family: "Montserrat", sans-serif;
        }

        .table-responsive {
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .btn-full-width {
            width: 100%;
            text-align: center;
            display: block;
        }






        .card-container{
        
           
            padding: 18px;
            border-radius: 18px;
            max-width: 5000px;
            width: 1400px;
            margin-left: -140px;
            margin-bottom: 20px;
            font-family: "Montserrat", sans-serif;
            background-color: white;
        }
        .finance-conatiner{
            border: 2px solid black;
            border-radius: 16px;
            padding: 25px;
            background-color: black;
            
            

        }

        .add-event-card {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 180px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            color: inherit; /* Ensures the text color doesn't change */
        }

        .add-event-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-color: #007bff; /* Or any color you prefer for hover state */
        }

        .add-event-icon {
            font-size: 3rem;
            color: #28a745;
        }
        .records{
            font-family: "Montserrat", sans-serif;
            
            
            
        }
        .inside-table{
            display: flex;
            align-content: space-between;
        }
        .account{
            font-size: 23px; 
            font-weight: 600;
            font-family: "Montserrat", sans-serif;
            color: white;
            margin: 0; /* Remove default margin */
        }

          
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
            
        }

        th {
            text-align: left;
            padding: 10px;
        }

        tr {
            border-radius: 10px;
            overflow: hidden;
            color: white;
            font-family: "Montserrat", sans-serif;
            font-size: 16px;
            font-weight: 400;
        }

        td {
            padding: 15px;
            vertical-align: middle;
        }
        

        
        .rounded-row td:first-child {
        border-top-left-radius: 13px;
        border-bottom-left-radius: 13px;
    }

    .rounded-row td:last-child {
        border-top-right-radius: 13px;
        border-bottom-right-radius: 13px;
    }
    .row-from{
        font-size: 10px;
        transition: border-color 0.3s ease;
        font-family: "Montserrat", sans-serif;
    }

    .rounded-row:hover {
    border: 2px solid red; /* Red border on hover */
     }
     

   


    

    /* Optional: Adding border styling to enhance the effect */
   
       

        
        

       





    .card-menu {
        position: absolute;
        top: 2px;
        right: 2px;
        cursor: pointer;
        z-index: 50; /* Ensure it's above other elements */
    }

    .card-menu-content {
        display: none;
        position: absolute;
        right: 0;
        top: 20px; /* Position it below the dots */
        background-color: #f9f9f9;
        min-width: 120px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 11; /* Ensure it's above the card-menu */
        border-radius: 4px;
    }
    

    .card-menu-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .card-menu-content a:hover {
        background-color: #f1f1f1;
        border-radius: 4px;
    }

    .card.delete-mode {
        opacity: 0.7;
        transition: opacity 0.3s ease;
    }

    .card.selected-for-delete {
        border: 2px solid red;
        opacity: 1;
    }

    .delete-button {
        display: none;
        position: fixed;
        bottom: 20px;
        margin-right: 50px;
        padding: 10px;
        background-color: red;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .delete-button.show {
        display: block;
    }

    #deleteButton {
        font-size: 16px;
        font-weight: 600;
        border-radius: 5px;
        transition: background-color 0.3s ease;
    }

    #deleteButton:hover {
        background-color: #2c2c2c;
    }

    #logoutButton {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
    }

    .logout-icon-box {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 45px;
        height: 40px;
        background-color: black; /* Linear gradient from left to right */   
        border-radius: 8px; /* Slightly rounded corners for a modern look */
        transition: all 0.3s ease;
    }

    .logout-icon-box svg {
        fill: white;
        stroke: white;
        transition: all 0.3s ease;
    }

    #logoutButton:hover .logout-icon-box {
        opacity: 0.8; /* Slight opacity change on hover for visual feedback */
    }

    #logoutButton:hover .logout-icon-box svg {
        fill: white; /* Keep icon white on hover */
        stroke: white;
    }

    .adjust-margin {
        margin-left: 67px !important;
    }

    .delete-circle {
        position: absolute;
        top: 10px;
        left: 10px;
        width: 20px;
        height: 20px;
        border: 2px solid white;
        border-radius: 50%;
        z-index: 10;
        cursor: pointer;
    }

    .inner-circle {
        display: none;
        width: 12px;
        height: 12px;
        background-color: white;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .card.selected-for-delete .inner-circle {
        display: block;
    }

    .header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .delete-btn {
        background-color: transparent;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 34px; /* Adjust size as needed */
        padding: 10px;
        transition: color 0.3s ease;
    }

    .delete-btn:hover {
        color: #ff4d4d; /* Red color on hover */
    }

    .edit-btn {
        background-color: transparent;
        color: white;
        border: none;
        cursor: pointer;
        font-size: 18px;
        padding: 10px;
        transition: color 0.3s ease;
    }

    .edit-btn:hover {
        color: #4d94ff; /* Blue color on hover */
    }

    .edit-circle {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 20px;
        height: 20px;
        border: 2px solid white;
        border-radius: 50%;
        z-index: 10;
        cursor: pointer;
        display: none;
    }

    .edit-icon {
        color: white;
        font-size: 12px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .card.edit-mode .edit-circle {
        display: block;
    }
 


    </style>
</head>
<body style="background-color: #1A1919;">
    <div class="container mt-4">
        <div class="row">
        {% load static %}
        <div style="display: flex; justify-content: space-between; align-items: center; margin-left: -30px; margin-right: -30px; padding-right: 20px; margin-top: 10px;">
            <!-- Image on the left -->
            <img src="{% static 'CAPEX.png' %}" alt="Top Left Image" class="top-left-image" style="margin-right: -10px;">
            
            <!-- Logout button on the right -->
            <button id="logoutButton" class="btn btn-link" aria-label="Logout">
                <span class="logout-icon-box" style="margin-right: -40px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="27" height="27">
                        <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"
                              fill="white" stroke="white" stroke-width="0.5"/>
                    </svg>
                </span>
            </button>
        </div>
        </div>
        

        

        <!-- Card Container Box -->
        <div style="margin-top: 40px; margin-left: -45px; background-color: black; border: black;" class="card-container">
            <div class="header-row">
                <p class="account">ACCOUNTS</p>
                <div>
                    {% if show_edit_button %}
                    <button id="editButton" onclick="toggleEditMode()" class="edit-btn" style="margin-right: 15px;">
                        <i class="fas fa-edit"></i>
                    </button>
                    {% endif %}
                    {% if show_delete_menu %}
                    <button id="deleteButton" onclick="toggleDeleteMode()" class="delete-btn" style="margin-right: 25px;">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                    {% endif %}
                </div>
            </div>
            <div style="margin-top: 30px;" class="row">
                <!-- Loop through existing events to display their cards -->
                {% for event in events %}
                    <div class="col-md-4 mb-4">
                        <div class="card" onclick="toggleFinanceTable({{ event.id }})" data-event-id="{{ event.id }}">
                            <div class="delete-circle" style="display: none;">
                                <div class="inner-circle"></div>
                            </div>
                            <div class="edit-circle" style="display: none;">
                                <i class="fas fa-pencil-alt edit-icon"></i>
                            </div>
                            <div class="card-body" style="background-color: #1A1919;">
                                <!-- Existing card content -->
                                <div class="d-flex justify-content-between align-items-center">
                                    <p class="card-title mb-0" style="font-weight: 400; font-size: 16px;">
                                        
                                        {{ event.event_name }}
                                    </p>
                                    <p class="total-amount mb-0" id="total-amount-{{ event.id }}">
                                        ₹ {{ event.total_amount|default:"0.00" }}
                                    </p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <p class="card-text" style="margin-top: 25px; font-weight: 400; font-size: 16px;">{{ event.user_name }}</p>
                                    <p class="card-text" style="margin-top: 25px; font-weight: 400; font-size: 16px;">{{ event.event_amount }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}

            {% if show_add_button %}
                        <div class="col-md-4 mb-4">
        <a href="{% url 'create_event' %}" style="text-decoration: none; display: block;">
            <div class="card" style="height: 100px; background-color: #1A1919; align-items: center;">
                <div class="add-event-icon" style="font-size: 36px; color: white; margin-top: 21px; text-align: center;">+</div>
            </div>
        </a>
    </div>
</div>
            {% endif %}
            
                
                <!-- Permanent "Add Event" Card, always at the end -->
                
            </div>
        </div>
    

        
        
        <!-- Finance Table Container Box -->
        
            {% for event in events %}
                <div id="finance-table-{{ event.id }}" class="table-responsive hidden {% if show_add_button %}adjust-margin{% endif %}" style="width: 1400px; margin-left: -45px; ">
                    <div class="finance-conatiner">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <p style="font-size: 23px; font-weight: 600; color: white;" class="records">RECORDS</p>
                            <span onclick="collapseTable({{ event.id }})" style="cursor: pointer; margin-right: -1040px;" title="Collapse">
                                <i class="fas fa-chevron-up" style="color: white; font-size: 28px;"></i>
                            </span>


                            <span onclick="downloadTableAsPDF({{ event.id }})" style="cursor: pointer;" title="Download PDF">
                                <i class="fas fa-download" style="color: white; font-size: 23px; margin-left: -45px;"></i>
                            </span>
                        </div>
                    
                  
                    <div class="d-flex justify-content-between align-items-center mb-3" style="font-family: 'Montserrat', sans-serif; ">
                        <h4 class="mb-0" style="font-size: 16px; font-weight: 400; color: white;" >Account : {{ event.event_name }}</h4>
                        <div style="font-size: 16px; font-weight: 400; color: white;>
                         <h4 class="mb-0" >Account Holder : {{ event.user_name }}</h4>
                        </div>
                        <div style="font-size: 16px; font-weight: 400; color: white; >
                        <p class="total-amount mb-0" id="finance-total-amount-{{ event.id }}">
                            Account Balance: ₹ {{ event.total_amount|default:"0.00" }}
                        </p>
                        </div>
                    </div>
                    
                    
                  
                    <table>
                        
                        <thead>
                            <tr style="font-size: 15px; font-weight: 200;">
                                <th>From</th>
                                <th>To</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Mode</th>
                            </tr>
                        </thead>
                        </div>
                        <div>
                        <tbody>
                        
                            {% for finance in event.finances.all %}
                            
                            
                            
                                <tr class="rounded-row" data-amount="{{ finance.amount }}" style="background-color: #1A1919; color: white;">
                                
                                 
                                    <td>{{ finance.from_person }}</td>
                                    <td>{{ finance.to_person }}</td>
                                    <td>{{ finance.description }}</td>
                                    <td>{{ finance.amount }}</td>
                                    <td>{{ finance.date_event }}</td>
                                    <td>{{ finance.mode }}</td>
                                
                                </tr>
                            
                        
                            {% empty %}
                                <tr>
                                    <td colspan="6">No finance records found.</td>
                                </tr>
                            {% endfor %}
                        </div>
                        </tbody>
                        </div>
                    </table>
                    <div class="mt-3">
                        <a href="{% url 'add_finance' event.id %}" class="btn btn-full-width" style="background-color: #1A1919; color: white; font-size: 30px; font-weight: 700; display: inline-block; text-align: center; text-decoration: none; padding: 10px;">+</a>
                    </div>
                    
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    



    
  

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        function calculateTotalAmounts() {
            var events = document.querySelectorAll('.card');
            events.forEach(function(event) {
                var eventId = event.getAttribute('onclick').match(/\d+/)[0];
                var totalAmountElement = document.getElementById('total-amount-' + eventId);
                var financeTable = document.getElementById('finance-table-' + eventId);
                var financeTotalAmountElement = document.getElementById('finance-total-amount-' + eventId);
                var totalAmount = 0;

                if (financeTable) {
                    var rows = financeTable.querySelectorAll('tbody tr');
                    rows.forEach(function(row) {
                        var amount = parseFloat(row.getAttribute('data-amount'));
                        if (!isNaN(amount)) {
                            totalAmount += amount;
                        }
                    });

                    financeTotalAmountElement.textContent = 'Account Balance: ₹ ' + totalAmount.toFixed(2);
                }

                totalAmountElement.textContent = '₹' + totalAmount.toFixed(2);
            });
        }

          function toggleFinanceTable(eventId) {
            if (deleteMode) return; // Don't toggle table if in delete mode

            var allTables = document.querySelectorAll('[id^="finance-table-"]');
            var clickedTable = document.getElementById('finance-table-' + eventId);
            var clickedCard = document.querySelector('.card[data-event-id="' + eventId + '"]');
            var allCards = document.querySelectorAll('.card');
            
            // Remove selected class from all cards
            allCards.forEach(function(card) {
                card.classList.remove('selected');
            });

            // Close all other tables
            allTables.forEach(function(table) {
                if (table !== clickedTable) {
                    table.classList.add('hidden');
                }
            });

            // Toggle the clicked table
            clickedTable.classList.toggle('hidden');

            // If the table is now visible, add selected class and scroll to it
            if (!clickedTable.classList.contains('hidden')) {
                clickedCard.classList.add('selected');
                setTimeout(function() {
                    clickedTable.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100); // Small delay to ensure the table is visible before scrolling
            } else {
                // If closing, remove selected class and scroll back to the card
                clickedCard.classList.remove('selected');
                clickedCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function showPopup(eventId) {
            var popup = document.getElementById("popup");
            var overlay = document.getElementById("popup-overlay");
            var popupContent = document.getElementById("popup-content");

            var url = "{% url 'add_finance' 0 %}".replace('0', eventId);

            fetch(url)
                .then(response => response.text())
                .then(html => {
                    popupContent.innerHTML = html;
                    initializePopupJavaScript();
                    popup.classList.add("show");
                    overlay.classList.add("show");
                })
                .catch(error => console.error('Error fetching popup content:', error));
        }

        function closePopup() {
            var popup = document.getElementById("popup");
            var overlay = document.getElementById("popup-overlay");

            popup.classList.remove("show");
            overlay.classList.remove("show");
            window.location.href = "{% url 'index' %}";
        }

        function initializePopupJavaScript() {
            document.getElementById('expense-button').addEventListener('click', function() {
                window.amountSign = -1;
            });

            document.getElementById('income-button').addEventListener('click', function() {
                window.amountSign = 1;
            });

            document.querySelector('#popup form').addEventListener('submit', function(event) {
                var amountField = document.querySelector('#popup [name="amount"]');
                amountField.value = (parseFloat(amountField.value) * window.amountSign).toFixed(2);
            });
        }

        document.addEventListener('DOMContentLoaded', calculateTotalAmounts);

        function closePopup() {
    var popup = document.getElementById("popup");
    var overlay = document.getElementById("popup-overlay");

    // Hide the popup and overlay
    popup.classList.remove("show");
    overlay.classList.remove("show");

    // Redirect to the specified URL
    window.location.href = "{% url 'index' %}";
}


document.getElementById('logoutButton').addEventListener('click', function() {
    if (confirm('Are you sure you want to log out?')) {
        // You may want to send a request to your server to invalidate the session
        // For now, we'll just redirect to the login page
        window.location.href = "{% url 'login' %}";
    }
});

    // Function to toggle the card menu
    function toggleCardMenu(event) {
        event.stopPropagation();
        var menu = document.getElementById('card-menu-container');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    let deleteMode = false;

function toggleDeleteMode() {
    deleteMode = !deleteMode;
    const cards = document.querySelectorAll('.card');
    const deleteButton = document.getElementById('deleteButton');
    const deleteSelectedButton = document.getElementById('deleteSelectedButton');
    
    cards.forEach(card => {
        const deleteCircle = card.querySelector('.delete-circle');
        if (deleteMode) {
            card.classList.add('delete-mode');
            deleteCircle.style.display = 'block'; // Show delete indicator
            card.setAttribute('data-onclick', card.getAttribute('onclick')); // Temporarily disable original onclick
            card.removeAttribute('onclick');
        } else {
            card.classList.remove('delete-mode');
            card.classList.remove('selected-for-delete');
            deleteCircle.style.display = 'none'; // Hide delete indicator
            card.setAttribute('onclick', card.getAttribute('data-onclick')); // Restore original onclick
            card.removeAttribute('data-onclick');
        }
    });

    if (deleteMode) {
        deleteButton.style.backgroundColor = 'red'; // Change to "Delete Mode" visual indicator
        deleteSelectedButton.style.display = 'block'; // Show the delete button for selected items
    } else {
        deleteButton.style.backgroundColor = '#1A1919'; // Back to default
        deleteSelectedButton.style.display = 'none'; // Hide delete button when exiting delete mode
    }
}

document.addEventListener('click', function(event) {
    if (deleteMode && (event.target.closest('.card') || event.target.closest('.delete-circle'))) {
        event.preventDefault();
        event.stopPropagation();
        const card = event.target.closest('.card');
        card.classList.toggle('selected-for-delete');
        updateDeleteSelectedButton();
    }
});

function updateDeleteSelectedButton() {
    const selectedCards = document.querySelectorAll('.card.selected-for-delete');
    const deleteSelectedButton = document.getElementById('deleteSelectedButton');
    deleteSelectedButton.style.display = selectedCards.length > 0 ? 'inline-block' : 'none';
}

function deleteSelectedEvents() {
    const selectedCards = document.querySelectorAll('.card.selected-for-delete');
    if (selectedCards.length === 0) {
        alert('No cards selected for deletion.');
        return;
    }

    if (confirm('Are you sure you want to delete the selected events and all associated finances?')) {
        const deletePromises = Array.from(selectedCards).map(card => {
            const eventId = card.getAttribute('data-event-id');
            return deleteEvent(eventId, card);
        });

        // Hide the DELETE SELECTED button immediately
        document.getElementById('deleteSelectedButton').style.display = 'none';

        Promise.all(deletePromises)
            .then(() => {
                // All events deleted successfully
                exitDeleteMode();
            })
            .catch(error => {
                console.error('Error deleting events:', error);
                alert('An error occurred while deleting events. Please try again.');
                // Show the DELETE SELECTED button again in case of error
                updateDeleteSelectedButton();
            });
    }
}

function deleteEvent(eventId, cardElement) {
    return fetch(`/delete-event/${eventId}/`, {
        method: 'POST',  // Changed to POST as per your view method
        headers: {
            'X-CSRFToken': getCookie('csrftoken'), // Ensure CSRF token is included
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Server responded with ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.status === 'success') {
            cardElement.remove(); // Remove the card from the DOM upon successful deletion
        } else {
            throw new Error(data.message);
        }
    })
    .catch(error => {
        console.error('Error deleting event:', error);
        alert(`Failed to delete event: ${error.message}`);
    });
}

function exitDeleteMode() {
    deleteMode = false;
    const cards = document.querySelectorAll('.card');
    const deleteButton = document.getElementById('deleteButton');
    
    cards.forEach(card => {
        const deleteCircle = card.querySelector('.delete-circle');
        card.classList.remove('delete-mode');
        card.classList.remove('selected-for-delete');
        deleteCircle.style.display = 'none'; // Hide delete circle
        card.setAttribute('onclick', card.getAttribute('data-onclick'));
        card.removeAttribute('data-onclick');
    });
    
    deleteButton.style.backgroundColor = '#1A1919'; // Reset button style
}

function deleteEvent(eventId, cardElement) {
    return fetch(`/delete-event/${eventId}/`, {
        method: 'POST',  // POST request as per your Django view
        headers: {
            'X-CSRFToken': getCookie('csrftoken'), // Make sure CSRF token is included
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`Server responded with ${response.status}: ${response.statusText}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.status === 'success') {
            // Remove the card from the DOM if the deletion was successful
            cardElement.remove();
        } else {
            throw new Error(data.message);
        }
    })
    .catch(error => {
        console.error('Error deleting event:', error);
        alert(`Failed to delete event: ${error.message}`);
    });
}


function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}





    // Close all card menus when clicking outside
    document.addEventListener('click', function(event) {
        var menus = document.querySelectorAll('.card-menu-content');
        menus.forEach(function(menu) {
            if (menu.style.display === 'block' && !menu.contains(event.target) && !event.target.closest('.card-menu')) {
                menu.style.display = 'none';
            }
        });
    });

    function collapseTable(eventId) {
        var table = document.getElementById('finance-table-' + eventId);
        var card = document.querySelector('.card[data-event-id="' + eventId + '"]');
        
        table.classList.add('hidden');
        // Keep the 'selected' class on the card
        card.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    let editMode = false;

    function toggleEditMode() {
        editMode = !editMode;
        const cards = document.querySelectorAll('.card');
        const editButton = document.getElementById('editButton');
        
        cards.forEach(card => {
            const editCircle = card.querySelector('.edit-circle');
            if (editMode) {
                card.classList.add('edit-mode');
                editCircle.style.display = 'block';
                card.setAttribute('data-onclick', card.getAttribute('onclick'));
                card.removeAttribute('onclick');
            } else {
                card.classList.remove('edit-mode');
                editCircle.style.display = 'none';
                card.setAttribute('onclick', card.getAttribute('data-onclick'));
                card.removeAttribute('data-onclick');
            }
        });
        
        if (editMode) {
            editButton.style.color = '#4d94ff';
        } else {
            editButton.style.color = 'white';
        }
    }

    document.addEventListener('click', function(event) {
        if (editMode && event.target.closest('.edit-circle')) {
            event.preventDefault();
            event.stopPropagation();
            const card = event.target.closest('.card');
            const eventId = card.getAttribute('data-event-id');
            window.location.href = `/edit-event/${eventId}/`;
        }
    });
    function downloadTableAsPDF(eventId) {
    // Get the finance table
    const financeTable = document.getElementById('finance-table-' + eventId);
    if (!financeTable) {
        alert('Finance table not found!');
        return;
    }

    // Get the account holder and balance
    const eventName = event.target.getAttribute('data-event-name') || 'CFO';
    
    const accountBalanceElement = document.getElementById(`finance-total-amount-${eventId}`);
    const accountBalance = accountBalanceElement ? accountBalanceElement.innerText.replace('Account Balance: ₹ ', '') : '0.00';

    const rows = financeTable.querySelectorAll('tbody tr');

    // Prepare CSV content
    let csvContent = '';

    // Add title row with Account Holder and Account Balance
    csvContent += `Account Holder: ${eventName}, Account Balance: ₹${accountBalance}\n\n`;

    // Add headers
    const headers = ['From', 'To', 'Description', 'Amount', 'Date', 'Mode'];
    csvContent += headers.join(',') + '\n'; // Convert header array to CSV format

    // Add table rows
    rows.forEach(row => {
        const rowData = Array.from(row.querySelectorAll('td')).map(cell => cell.innerText);
        csvContent += rowData.join(',') + '\n'; // Convert row data to CSV format
    });

    // Create a blob for the CSV content
    const csvBlob = new Blob([csvContent], { type: 'text/csv' });

    // Create a download link
    const downloadLink = document.createElement('a');
    downloadLink.href = URL.createObjectURL(csvBlob);
    downloadLink.download = `finance_records_event_${eventId}.csv`;

    // Append the link to the document and trigger the download
    document.body.appendChild(downloadLink);
    downloadLink.click();

    // Clean up by removing the link
    document.body.removeChild(downloadLink);
}


    </script>
    <button id="deleteSelectedButton" onclick="deleteSelectedEvents()" style="display: none; position: fixed; bottom: 20px; right: 20px; background-color: red; color: white; border: none; padding: 10px 20px; cursor: pointer; font-family: 'Montserrat', sans-serif; border-radius: 5px;">Delete Selected</button>

    <!-- At the bottom of the file, just before </body> -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                console.log("Card hover color:", card.style.getPropertyValue('--hover-color'));
            });
        });
    </script>
</body>
</html>